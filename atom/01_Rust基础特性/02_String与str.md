# String ä¸ str

## ã€30å­—æ ¸å¿ƒã€‘

**String æ˜¯å †åˆ†é…çš„å¯å˜å­—ç¬¦ä¸²ï¼Œ&str æ˜¯å­—ç¬¦ä¸²åˆ‡ç‰‡å¼•ç”¨ï¼Œripgrep ä¸­å¤§é‡ç”¨äºæ¨¡å¼åŒ¹é…å’Œè·¯å¾„å¤„ç†ã€‚**

---

## ã€ç¬¬ä¸€æ€§åŸç†ã€‘

### ä»€ä¹ˆæ˜¯ç¬¬ä¸€æ€§åŸç†ï¼Ÿ

**ç¬¬ä¸€æ€§åŸç†**ï¼šå›åˆ°äº‹ç‰©æœ€åŸºæœ¬çš„çœŸç†ï¼Œä»æºå¤´æ€è€ƒé—®é¢˜

### String ä¸ str çš„ç¬¬ä¸€æ€§åŸç† ğŸ¯

#### 1. æœ€åŸºç¡€çš„å®šä¹‰

**String = å †ä¸Šå¯å¢é•¿çš„ UTF-8 å­—èŠ‚åºåˆ—ï¼Œæ‹¥æœ‰æ‰€æœ‰æƒ**

**&str = å¯¹ UTF-8 å­—èŠ‚åºåˆ—çš„å€Ÿç”¨è§†å›¾ï¼Œä¸æ‹¥æœ‰æ•°æ®**

ä»…æ­¤è€Œå·²ï¼æ²¡æœ‰æ›´åŸºç¡€çš„äº†ã€‚

#### 2. ä¸ºä»€ä¹ˆéœ€è¦ä¸¤ç§å­—ç¬¦ä¸²ç±»å‹ï¼Ÿ

**æ ¸å¿ƒé—®é¢˜ï¼šå¦‚ä½•åœ¨ä¿è¯å†…å­˜å®‰å…¨çš„åŒæ—¶ï¼Œæä¾›çµæ´»é«˜æ•ˆçš„å­—ç¬¦ä¸²æ“ä½œï¼Ÿ**

Rust çš„ç­”æ¡ˆæ˜¯ï¼š**æ‰€æœ‰æƒ + å€Ÿç”¨**

- **String**ï¼šå½“ä½ éœ€è¦æ‹¥æœ‰ã€ä¿®æ”¹ã€å¢é•¿å­—ç¬¦ä¸²æ—¶ä½¿ç”¨
- **&str**ï¼šå½“ä½ åªéœ€è¦è¯»å–ã€å¼•ç”¨å­—ç¬¦ä¸²æ—¶ä½¿ç”¨

#### 3. String ä¸ str çš„ä¸‰å±‚ä»·å€¼

##### ä»·å€¼1ï¼šå†…å­˜å®‰å…¨
```rust
// String æ‹¥æœ‰æ•°æ®ï¼Œç¦»å¼€ä½œç”¨åŸŸè‡ªåŠ¨é‡Šæ”¾
{
    let s = String::from("hello");
} // s è¢«é‡Šæ”¾ï¼Œå†…å­˜å®‰å…¨

// &str å€Ÿç”¨æ•°æ®ï¼Œä¸è´Ÿè´£é‡Šæ”¾
fn print_str(s: &str) {
    println!("{}", s);
} // ä¸é‡Šæ”¾ï¼Œå› ä¸ºä¸æ‹¥æœ‰
```

##### ä»·å€¼2ï¼šé›¶æˆæœ¬æŠ½è±¡
```rust
// &str åªæ˜¯ä¸€ä¸ªèƒ–æŒ‡é’ˆ (ptr, len)ï¼Œæ— å †åˆ†é…
let s: &str = "hello";  // é›¶æˆæœ¬ï¼ŒæŒ‡å‘é™æ€å†…å­˜

// åˆ‡ç‰‡ä¹Ÿæ˜¯é›¶æˆæœ¬
let full = String::from("hello world");
let part: &str = &full[0..5];  // é›¶æˆæœ¬ï¼Œåªæ˜¯è§†å›¾
```

##### ä»·å€¼3ï¼šAPI äººä½“å·¥å­¦
```rust
// å‡½æ•°æ¥å— &strï¼Œå¯ä»¥åŒæ—¶æ¥å— String å’Œ &str
fn search(pattern: &str) { /* ... */ }

search("literal");           // &str ç›´æ¥ä¼ 
search(&String::from("owned")); // String ä¹Ÿèƒ½ä¼ ï¼ˆè‡ªåŠ¨ Derefï¼‰
```

#### 4. ä»ç¬¬ä¸€æ€§åŸç†æ¨å¯¼æœ€ä½³å®è·µ

**æ¨ç†é“¾ï¼š**
```
1. å­—ç¬¦ä¸²æ•°æ®éœ€è¦å­˜å‚¨åœ¨æŸå¤„
   â†“
2. å­˜å‚¨ä½ç½®ï¼šæ ˆï¼ˆå›ºå®šå¤§å°ï¼‰æˆ–å †ï¼ˆå¯å˜å¤§å°ï¼‰
   â†“
3. å­—ç¬¦ä¸²é•¿åº¦å¯å˜ â†’ å¿…é¡»ç”¨å †ï¼ˆStringï¼‰
   â†“
4. å †æ•°æ®éœ€è¦æ‰€æœ‰æƒç®¡ç† â†’ String æ‹¥æœ‰æ‰€æœ‰æƒ
   â†“
5. ä½†å¾ˆå¤šæ—¶å€™åªéœ€è¦"çœ‹ä¸€çœ¼"â†’ å€Ÿç”¨æ¯”å¤åˆ¶æ›´é«˜æ•ˆ
   â†“
6. &str å°±æ˜¯"çœ‹ä¸€çœ¼"çš„è§†å›¾ â†’ é›¶æˆæœ¬å¼•ç”¨
   â†“
7. å‡½æ•°å‚æ•°ç”¨ &str â†’ æœ€å¤§çµæ´»æ€§ + é›¶æˆæœ¬
```

#### 5. ä¸€å¥è¯æ€»ç»“ç¬¬ä¸€æ€§åŸç†

**String æ˜¯"æ‹¥æœ‰"ï¼Œ&str æ˜¯"å€Ÿç”¨"ï¼›éœ€è¦ä¿®æ”¹ç”¨ Stringï¼Œåªéœ€è¯»å–ç”¨ &strã€‚**

---

## ã€æ ¸å¿ƒæ¦‚å¿µã€‘

### æ ¸å¿ƒæ¦‚å¿µ1ï¼šæ‰€æœ‰æƒåŒºåˆ« ğŸ”‘

**String æ‹¥æœ‰æ•°æ®ï¼Œ&str å€Ÿç”¨æ•°æ®**

```rust
// Stringï¼šæ‹¥æœ‰æ•°æ®ï¼Œå¯ä¿®æ”¹
let mut owned = String::from("hello");
owned.push_str(" world");  // âœ… å¯ä»¥ä¿®æ”¹
println!("{}", owned);     // "hello world"

// &strï¼šå€Ÿç”¨æ•°æ®ï¼Œä¸å¯ä¿®æ”¹
let borrowed: &str = "hello";
// borrowed.push_str(" world");  // âŒ ç¼–è¯‘é”™è¯¯ï¼
```

**å…³é”®åŒºåˆ«ï¼š**

| ç‰¹æ€§ | String | &str |
|-----|--------|------|
| æ‰€æœ‰æƒ | æ‹¥æœ‰ | å€Ÿç”¨ |
| å­˜å‚¨ä½ç½® | å † | æŒ‡å‘ä»»ä½•åœ°æ–¹ |
| å¯ä¿®æ”¹ | æ˜¯ï¼ˆmutï¼‰ | å¦ |
| å¯å¢é•¿ | æ˜¯ | å¦ |
| ç¦»å¼€ä½œç”¨åŸŸ | é‡Šæ”¾å†…å­˜ | ä»€ä¹ˆéƒ½ä¸åš |

**åœ¨ ripgrep æºç ä¸­çš„åº”ç”¨ï¼š**
- é…ç½®ç»“æ„ä½“çš„å­—æ®µï¼šéœ€è¦æ‰€æœ‰æƒçš„ç”¨ `String`
- å‡½æ•°å‚æ•°ï¼šç»å¤§å¤šæ•°ç”¨ `&str`
- æ­£åˆ™æ¨¡å¼ï¼š`Regex::new()` æ¥å— `&str`

---

### æ ¸å¿ƒæ¦‚å¿µ2ï¼šå†…å­˜å¸ƒå±€ ğŸ“

**String = (ptr, len, capacity)ï¼Œ&str = (ptr, len)**

```
String å†…å­˜å¸ƒå±€ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ptr â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚
â”‚ len: 5          â”‚     â–¼
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”
â”‚ capacity: 8     â”‚   â”‚  h  â”‚  e  â”‚  l  â”‚  l  â”‚  o  â”‚     â”‚     â”‚     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜
      æ ˆ (24å­—èŠ‚)                        å † (capacity å­—èŠ‚)


&str å†…å­˜å¸ƒå±€ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ptr â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚
â”‚ len: 5          â”‚     â–¼
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”
      æ ˆ (16å­—èŠ‚)      â”‚  h  â”‚  e  â”‚  l  â”‚  l  â”‚  o  â”‚  (æ•°æ®åœ¨åˆ«å¤„)
                      â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜
```

```rust
use std::mem::size_of;

fn main() {
    // String åœ¨æ ˆä¸Šå  24 å­—èŠ‚ï¼ˆ3 ä¸ª usizeï¼‰
    println!("String size: {} bytes", size_of::<String>()); // 24

    // &str åœ¨æ ˆä¸Šå  16 å­—èŠ‚ï¼ˆ2 ä¸ª usizeï¼‰
    println!("&str size: {} bytes", size_of::<&str>());     // 16
}
```

**åœ¨ ripgrep æºç ä¸­çš„åº”ç”¨ï¼š**
- ä¼ é€’ `&str` æ¯”ä¼ é€’ `String` æ›´è½»é‡ï¼ˆ16 vs 24 å­—èŠ‚ï¼Œä¸”æ— éœ€å…‹éš†å †æ•°æ®ï¼‰
- åˆ‡ç‰‡æ“ä½œæ˜¯é›¶æˆæœ¬çš„ï¼Œripgrep å¤§é‡ä½¿ç”¨åˆ‡ç‰‡æ¥å¤„ç†åŒ¹é…ç»“æœ

---

### æ ¸å¿ƒæ¦‚å¿µ3ï¼šç±»å‹è½¬æ¢ ğŸ”„

**&String â†’ &strï¼ˆè‡ªåŠ¨ Derefï¼‰ã€&str â†’ Stringï¼ˆéœ€è¦åˆ†é…ï¼‰**

```rust
fn main() {
    // ===== &str â†’ String =====
    let s1: &str = "hello";

    // æ–¹æ³•1ï¼što_string()
    let owned1: String = s1.to_string();

    // æ–¹æ³•2ï¼što_owned()
    let owned2: String = s1.to_owned();

    // æ–¹æ³•3ï¼šString::from()
    let owned3: String = String::from(s1);

    // æ–¹æ³•4ï¼šinto()
    let owned4: String = s1.into();

    // ===== &String â†’ &strï¼ˆè‡ªåŠ¨ Derefï¼‰=====
    let owned = String::from("world");

    // æ˜¾å¼è½¬æ¢
    let borrowed1: &str = &owned[..];
    let borrowed2: &str = owned.as_str();

    // éšå¼ Derefï¼ˆæœ€å¸¸ç”¨ï¼‰
    fn takes_str(s: &str) {
        println!("{}", s);
    }
    takes_str(&owned);  // String è‡ªåŠ¨è½¬ &str
}
```

**è½¬æ¢æˆæœ¬å¯¹æ¯”ï¼š**

| è½¬æ¢æ–¹å‘ | æˆæœ¬ | è¯´æ˜ |
|---------|------|------|
| &String â†’ &str | é›¶æˆæœ¬ | åªæ˜¯æ”¹å˜ç±»å‹ï¼Œä¸å¤åˆ¶æ•°æ® |
| &str â†’ String | å †åˆ†é… | éœ€è¦å¤åˆ¶æ•°æ®åˆ°æ–°åˆ†é…çš„å †å†…å­˜ |

**åœ¨ ripgrep æºç ä¸­çš„åº”ç”¨ï¼š**
- å‡½æ•°å‚æ•°ç”¨ `&str`ï¼Œè‡ªåŠ¨æ¥å— `String` å’Œ `&str`
- éœ€è¦å­˜å‚¨æ—¶æ‰è½¬ä¸º `String`

---

### æ ¸å¿ƒæ¦‚å¿µ4ï¼šå­—ç¬¦ä¸²å­—é¢é‡ ğŸ“

**"hello" çš„ç±»å‹æ˜¯ &'static strï¼Œå­˜å‚¨åœ¨ç¨‹åºçš„åªè¯»å†…å­˜æ®µ**

```rust
fn main() {
    // å­—ç¬¦ä¸²å­—é¢é‡æ˜¯ &'static str
    let s: &'static str = "hello";

    // 'static ç”Ÿå‘½å‘¨æœŸï¼šæ•´ä¸ªç¨‹åºè¿è¡ŒæœŸé—´æœ‰æ•ˆ
    // å­˜å‚¨åœ¨ç¨‹åºçš„ .rodata æ®µï¼ˆåªè¯»æ•°æ®æ®µï¼‰

    // å¯ä»¥çœç•¥ 'staticï¼Œç¼–è¯‘å™¨è‡ªåŠ¨æ¨æ–­
    let s: &str = "hello";  // å®é™…ä¸Šæ˜¯ &'static str
}

// å¯ä»¥ä»å‡½æ•°è¿”å›å­—ç¬¦ä¸²å­—é¢é‡
fn get_greeting() -> &'static str {
    "Hello, ripgrep!"
}
```

**åœ¨ ripgrep æºç ä¸­çš„åº”ç”¨ï¼š**
- é”™è¯¯ä¿¡æ¯ã€å¸®åŠ©æ–‡æœ¬ç­‰å›ºå®šå­—ç¬¦ä¸²éƒ½æ˜¯ `&'static str`
- é¿å…äº†ä¸å¿…è¦çš„å †åˆ†é…

---

## ã€æœ€å°å¯ç”¨ã€‘

æŒæ¡ä»¥ä¸‹å†…å®¹ï¼Œå°±èƒ½å¼€å§‹è¿›è¡Œ ripgrep æºç é˜…è¯»ï¼š

### 1. å‡½æ•°å‚æ•°ç”¨ &strï¼ˆé»„é‡‘æ³•åˆ™ï¼‰

```rust
// âœ… æ¨èï¼šæ¥å— &str
fn search(pattern: &str, text: &str) -> bool {
    text.contains(pattern)
}

// å¯ä»¥æ¥å— String å’Œ &str
search("hello", "hello world");           // &str
search(&String::from("hello"), "world");  // String è‡ªåŠ¨è½¬ &str
```

### 2. éœ€è¦æ‰€æœ‰æƒæ—¶ç”¨ String

```rust
// ç»“æ„ä½“å­—æ®µéœ€è¦æ‰€æœ‰æƒ
struct Config {
    pattern: String,   // éœ€è¦æ‹¥æœ‰
    path: String,      // éœ€è¦æ‹¥æœ‰
}

// ä»å‡½æ•°è¿”å›æ–°å­—ç¬¦ä¸²
fn create_message(name: &str) -> String {
    format!("Hello, {}!", name)
}
```

### 3. å­—ç¬¦ä¸²æ‹¼æ¥

```rust
fn main() {
    // æ–¹æ³•1ï¼šformat! å®ï¼ˆæœ€æ¸…æ™°ï¼‰
    let s = format!("{} {}", "hello", "world");

    // æ–¹æ³•2ï¼špush_strï¼ˆåŸåœ°ä¿®æ”¹ï¼‰
    let mut s = String::from("hello");
    s.push_str(" world");

    // æ–¹æ³•3ï¼š+ æ“ä½œç¬¦ï¼ˆæ¶ˆè€—å·¦è¾¹çš„ Stringï¼‰
    let s1 = String::from("hello");
    let s2 = " world";
    let s3 = s1 + s2;  // s1 è¢«ç§»åŠ¨ï¼Œä¸èƒ½å†ç”¨
}
```

### 4. åˆ‡ç‰‡æ“ä½œ

```rust
fn main() {
    let s = String::from("hello world");

    // è·å–åˆ‡ç‰‡
    let hello: &str = &s[0..5];    // "hello"
    let world: &str = &s[6..11];   // "world"
    let full: &str = &s[..];       // "hello world"

    // æ³¨æ„ï¼šç´¢å¼•æ˜¯å­—èŠ‚ä½ç½®ï¼Œä¸æ˜¯å­—ç¬¦ä½ç½®ï¼
    let chinese = "ä½ å¥½";
    // let first = &chinese[0..1];  // âŒ panic! UTF-8 å¤šå­—èŠ‚
    let first = &chinese[0..3];     // âœ… "ä½ "ï¼ˆ3å­—èŠ‚ï¼‰
}
```

**è¿™äº›çŸ¥è¯†è¶³ä»¥ï¼š**
- é˜…è¯» ripgrep ä¸­çš„å­—ç¬¦ä¸²å¤„ç†ä»£ç 
- ç†è§£ä¸ºä»€ä¹ˆå‡½æ•°å‚æ•°å¤§é‡ä½¿ç”¨ `&str`
- çŸ¥é“ä½•æ—¶éœ€è¦ `String`ï¼Œä½•æ—¶ç”¨ `&str`

---

## ã€ç±»æ¯”ã€‘

### ç±»æ¯”1ï¼šString vs &str

#### ğŸ¨ å‰ç«¯è§†è§’ï¼šJavaScript ä¸­çš„å­—ç¬¦ä¸²

```javascript
// JavaScript ä¸­å­—ç¬¦ä¸²æ˜¯ä¸å¯å˜çš„ï¼Œç±»ä¼¼ &str
const str = "hello";
// str[0] = 'H';  // ä¸èƒ½ä¿®æ”¹

// è¦"ä¿®æ”¹"å¿…é¡»åˆ›å»ºæ–°å­—ç¬¦ä¸²ï¼Œç±»ä¼¼ String
const newStr = str.toUpperCase();  // æ–°å¯¹è±¡
```

```rust
// Rust ä¸­çš„å¯¹åº”
let borrowed: &str = "hello";       // ç±»ä¼¼ JS çš„ const str
let mut owned = String::from("hello");
owned.push_str(" world");           // Rust å¯ä»¥çœŸæ­£ä¿®æ”¹
```

**å…³é”®åŒºåˆ«ï¼š** Rust çš„ String æ˜¯çœŸæ­£çš„å¯å˜å­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯åˆ›å»ºæ–°å¯¹è±¡ã€‚

#### ğŸ§’ å°æœ‹å‹è§†è§’ï¼šç¬”è®°æœ¬ vs çœ‹ä¹¦

**String åƒè‡ªå·±çš„ç¬”è®°æœ¬ï¼š**
- æ˜¯ä½ è‡ªå·±çš„ï¼ˆæ‹¥æœ‰æ‰€æœ‰æƒï¼‰
- å¯ä»¥åœ¨ä¸Šé¢å†™å­—ã€æ¶‚æ”¹ï¼ˆå¯ä¿®æ”¹ï¼‰
- å¯ä»¥åŠ é¡µï¼ˆå¯å¢é•¿ï¼‰
- ä½ è´Ÿè´£ä¿ç®¡ï¼ˆç¦»å¼€ä½œç”¨åŸŸè‡ªåŠ¨é‡Šæ”¾ï¼‰

**&str åƒçœ‹åˆ«äººçš„ä¹¦ï¼š**
- æ˜¯åˆ«äººçš„ä¹¦ï¼Œä½ åªæ˜¯å€Ÿæ¥çœ‹ï¼ˆå€Ÿç”¨ï¼‰
- ä¸èƒ½åœ¨ä¸Šé¢å†™å­—ï¼ˆåªè¯»ï¼‰
- çœ‹å®Œå°±è¿˜ï¼ˆä¸è´Ÿè´£é‡Šæ”¾ï¼‰
- å¯ä»¥çœ‹ä»»ä½•ä¸€é¡µï¼ˆåˆ‡ç‰‡ï¼‰

```rust
// è‡ªå·±çš„ç¬”è®°æœ¬
let mut notebook = String::from("æˆ‘çš„ç¬”è®°");
notebook.push_str("ï¼šä»Šå¤©å­¦ Rust");  // å¯ä»¥å†™

// çœ‹åˆ«äººçš„ä¹¦
let book: &str = "Rust ç¼–ç¨‹è¯­è¨€";
// book.push_str("å¾ˆå¥½çœ‹");  // âŒ ä¸èƒ½åœ¨åˆ«äººä¹¦ä¸Šå†™å­—ï¼
```

---

### ç±»æ¯”2ï¼šç±»å‹è½¬æ¢

#### ğŸ¨ å‰ç«¯è§†è§’

```javascript
// JS: å¤åˆ¶å­—ç¬¦ä¸²
const original = "hello";
const copy = original.slice();  // ç±»ä¼¼ to_owned()

// JS: è·å–å¼•ç”¨ï¼ˆJS è‡ªåŠ¨å¤„ç†ï¼‰
function print(s) { console.log(s); }
print(original);  // è‡ªåŠ¨ä¼ å¼•ç”¨
```

```rust
// Rust: å¤åˆ¶åˆ°æ–° String
let original: &str = "hello";
let copy: String = original.to_owned();  // å †åˆ†é…

// Rust: å€Ÿç”¨
fn print(s: &str) { println!("{}", s); }
print(original);  // ä¼ å¼•ç”¨ï¼Œé›¶æˆæœ¬
```

#### ğŸ§’ å°æœ‹å‹è§†è§’

**to_string() / to_owned() = æŠ„ä¹¦**
- çœ‹åˆ°ä¸€æœ¬å¥½ä¹¦ï¼ˆ&strï¼‰
- æƒ³è¦è‡ªå·±çš„ä¸€æœ¬ â†’ æŠ„å†™åˆ°è‡ªå·±çš„ç¬”è®°æœ¬ä¸Šï¼ˆStringï¼‰
- æŠ„ä¹¦éœ€è¦æ—¶é—´å’Œçº¸ï¼ˆå †åˆ†é…æˆæœ¬ï¼‰

**&String â†’ &str = æŠŠç¬”è®°æœ¬å€Ÿç»™åˆ«äººçœ‹**
- ä½ æœ‰è‡ªå·±çš„ç¬”è®°æœ¬ï¼ˆStringï¼‰
- æœ‹å‹æƒ³çœ‹ä¸€çœ¼ â†’ ä½ æŠŠæœ¬å­é€’ç»™ä»–çœ‹ï¼ˆ&strï¼‰
- å¾ˆå¿«ï¼Œä¸ç”¨æŠ„å†™ï¼ˆé›¶æˆæœ¬ï¼‰

---

### ç±»æ¯”æ€»ç»“è¡¨

| æ¦‚å¿µ | å‰ç«¯ç±»æ¯” | å°æœ‹å‹ç±»æ¯” |
|-----|---------|-----------|
| String | `let s = "hello"` åçš„å˜é‡ | è‡ªå·±çš„ç¬”è®°æœ¬ |
| &str | å­—ç¬¦ä¸²å­—é¢é‡ `"hello"` | çœ‹åˆ«äººçš„ä¹¦ |
| to_string() | `.slice()` åˆ›å»ºå‰¯æœ¬ | æŠ„ä¹¦åˆ°è‡ªå·±æœ¬å­ |
| &String â†’ &str | å‡½æ•°è‡ªåŠ¨ä¼ å¼•ç”¨ | æŠŠç¬”è®°æœ¬å€Ÿç»™åˆ«äººçœ‹ |
| å­—ç¬¦ä¸²å­—é¢é‡ | `const` å­—ç¬¦ä¸² | å°åˆ·å¥½çš„ä¹¦ï¼ˆæ°¸è¿œå­˜åœ¨ï¼‰ |
| åˆ‡ç‰‡ &s[0..5] | `s.substring(0, 5)` | åªçœ‹ä¹¦çš„ç¬¬1-5é¡µ |

---

## ã€åç›´è§‰ç‚¹ã€‘

### è¯¯åŒº1ï¼š"String æ›´å¼ºå¤§ï¼Œæ‰€ä»¥éƒ½ç”¨ String" âŒ

**ä¸ºä»€ä¹ˆé”™ï¼Ÿ**
- String éœ€è¦å †åˆ†é…ï¼Œæœ‰æ€§èƒ½å¼€é”€
- å‡½æ•°å‚æ•°ç”¨ String ä¼šå¼ºåˆ¶è°ƒç”¨è€…æ‹¥æœ‰æ•°æ®
- é™åˆ¶äº† API çš„çµæ´»æ€§

**ä¸ºä»€ä¹ˆäººä»¬å®¹æ˜“è¿™æ ·é”™ï¼Ÿ**
- ä» Java/Python æ¥çš„ç¨‹åºå‘˜ä¹ æƒ¯äº†"ä¸€ç§å­—ç¬¦ä¸²ç±»å‹"
- è§‰å¾—"åŠŸèƒ½å¤š = æ›´å¥½"

**æ­£ç¡®ç†è§£ï¼š**
```rust
// âŒ ä¸å¥½ï¼šå¼ºåˆ¶è°ƒç”¨è€…æ‹¥æœ‰ String
fn bad_search(pattern: String, text: String) -> bool {
    text.contains(&pattern)
}

// âœ… å¥½ï¼šæ¥å—å€Ÿç”¨ï¼Œæ›´çµæ´»
fn good_search(pattern: &str, text: &str) -> bool {
    text.contains(pattern)
}

// è°ƒç”¨å¯¹æ¯”
let p = "hello";
let t = String::from("hello world");

// bad_search(p, t);        // âŒ ç¼–è¯‘é”™è¯¯ï¼&str ä¸èƒ½ç›´æ¥è½¬ String
good_search(p, &t);         // âœ… éƒ½å¯ä»¥
```

---

### è¯¯åŒº2ï¼š"&str ä¸èƒ½ä»å‡½æ•°è¿”å›" âŒ

**ä¸ºä»€ä¹ˆé”™ï¼Ÿ**
- &str å¯ä»¥è¿”å›ï¼Œåªè¦ç”Ÿå‘½å‘¨æœŸæ­£ç¡®
- å­—ç¬¦ä¸²å­—é¢é‡æ˜¯ `&'static str`ï¼Œå¯ä»¥éšæ„è¿”å›
- å€Ÿç”¨æ•°æ®ä¹Ÿå¯ä»¥è¿”å›ï¼Œåªè¦æ ‡æ³¨ç”Ÿå‘½å‘¨æœŸ

**ä¸ºä»€ä¹ˆäººä»¬å®¹æ˜“è¿™æ ·é”™ï¼Ÿ**
- è¢«"å€Ÿç”¨ä¸èƒ½æ¯”æ‰€æœ‰è€…æ´»å¾—ä¹…"å“åˆ°äº†
- æ²¡æœ‰ç†è§£ 'static ç”Ÿå‘½å‘¨æœŸ

**æ­£ç¡®ç†è§£ï¼š**
```rust
// âœ… è¿”å›å­—ç¬¦ä¸²å­—é¢é‡ï¼ˆ&'static strï¼‰
fn get_greeting() -> &'static str {
    "Hello!"  // é™æ€ç”Ÿå‘½å‘¨æœŸï¼Œæ°¸è¿œæœ‰æ•ˆ
}

// âœ… è¿”å›è¾“å…¥çš„åˆ‡ç‰‡ï¼ˆç”Ÿå‘½å‘¨æœŸæ ‡æ³¨ï¼‰
fn first_word(s: &str) -> &str {
    match s.find(' ') {
        Some(i) => &s[..i],
        None => s,
    }
}

// âœ… ä½¿ç”¨ Cow çµæ´»è¿”å›
use std::borrow::Cow;

fn maybe_modify(s: &str, modify: bool) -> Cow<'_, str> {
    if modify {
        Cow::Owned(s.to_uppercase())  // è¿”å›æ–° String
    } else {
        Cow::Borrowed(s)              // è¿”å›å€Ÿç”¨
    }
}
```

---

### è¯¯åŒº3ï¼š"s[0] èƒ½è·å–ç¬¬ä¸€ä¸ªå­—ç¬¦" âŒ

**ä¸ºä»€ä¹ˆé”™ï¼Ÿ**
- Rust å­—ç¬¦ä¸²æ˜¯ UTF-8 ç¼–ç 
- UTF-8 æ˜¯å˜é•¿ç¼–ç ï¼Œä¸€ä¸ªå­—ç¬¦å¯èƒ½å  1-4 å­—èŠ‚
- ç´¢å¼•æ˜¯å­—èŠ‚ä½ç½®ï¼Œä¸æ˜¯å­—ç¬¦ä½ç½®

**ä¸ºä»€ä¹ˆäººä»¬å®¹æ˜“è¿™æ ·é”™ï¼Ÿ**
- ASCII å­—ç¬¦ä¸²ä¸­ 1 å­—ç¬¦ = 1 å­—èŠ‚
- å…¶ä»–è¯­è¨€ï¼ˆPythonã€JSï¼‰çš„ç´¢å¼•æ˜¯å­—ç¬¦ä½ç½®

**æ­£ç¡®ç†è§£ï¼š**
```rust
fn main() {
    let ascii = "hello";
    let chinese = "ä½ å¥½";

    // âŒ ç›´æ¥ç´¢å¼•å•ä¸ªä½ç½®ä¼š panic æˆ–ç¼–è¯‘é”™è¯¯
    // let c = chinese[0];  // ç¼–è¯‘é”™è¯¯ï¼

    // âœ… ä½¿ç”¨èŒƒå›´åˆ‡ç‰‡ï¼ˆå¿…é¡»åœ¨å­—ç¬¦è¾¹ç•Œï¼‰
    let first_chinese = &chinese[0..3];  // "ä½ "ï¼Œ3 å­—èŠ‚
    println!("{}", first_chinese);

    // âœ… ä½¿ç”¨ chars() è¿­ä»£å­—ç¬¦
    for c in chinese.chars() {
        println!("{}", c);  // "ä½ "ã€"å¥½"
    }

    // âœ… è·å–ç¬¬ä¸€ä¸ªå­—ç¬¦
    let first: Option<char> = chinese.chars().next();
    println!("{:?}", first);  // Some('ä½ ')
}
```

---

## ã€å®æˆ˜ä»£ç ã€‘

```rust
//! ç¤ºä¾‹ï¼šripgrep é£æ ¼çš„å­—ç¬¦ä¸²å¤„ç†
//! æ¼”ç¤º String ä¸ &str åœ¨å®é™…æœç´¢åœºæ™¯ä¸­çš„åº”ç”¨

use std::fs::File;
use std::io::{BufRead, BufReader};
use std::path::Path;

// ===== 1. å‡½æ•°å‚æ•°æœ€ä½³å®è·µ =====
/// æœç´¢å‡½æ•°ï¼šå‚æ•°ç”¨ &strï¼Œæœ€å¤§çµæ´»æ€§
fn search_in_line(pattern: &str, line: &str) -> Option<usize> {
    line.find(pattern)
}

// ===== 2. ç»“æ„ä½“å­—æ®µï¼šéœ€è¦æ‰€æœ‰æƒç”¨ String =====
struct SearchConfig {
    pattern: String,      // éœ€è¦æ‹¥æœ‰
    case_insensitive: bool,
}

impl SearchConfig {
    // æ„é€ å‡½æ•°æ¥å— &strï¼Œå†…éƒ¨è½¬ä¸º String
    fn new(pattern: &str) -> Self {
        Self {
            pattern: pattern.to_string(),
            case_insensitive: false,
        }
    }

    // æ–¹æ³•è¿”å› &strï¼Œé¿å…ä¸å¿…è¦çš„å¤åˆ¶
    fn pattern(&self) -> &str {
        &self.pattern
    }
}

// ===== 3. å¤„ç†åŒ¹é…ç»“æœ =====
struct Match {
    line_number: usize,
    line_content: String,  // éœ€è¦å­˜å‚¨ï¼Œç”¨ String
    match_start: usize,
}

impl Match {
    fn new(line_number: usize, line: &str, start: usize) -> Self {
        Self {
            line_number,
            line_content: line.to_string(),  // å¤åˆ¶åˆ°å †
            match_start: start,
        }
    }

    // è¿”å›åŒ¹é…çš„éƒ¨åˆ†ï¼ˆåˆ‡ç‰‡ï¼‰
    fn matched_text(&self, pattern_len: usize) -> &str {
        &self.line_content[self.match_start..self.match_start + pattern_len]
    }
}

// ===== 4. æ–‡ä»¶æœç´¢ç¤ºä¾‹ =====
fn search_file(path: &Path, pattern: &str) -> Vec<Match> {
    let mut results = Vec::new();

    let file = match File::open(path) {
        Ok(f) => f,
        Err(_) => return results,
    };

    let reader = BufReader::new(file);

    for (line_num, line_result) in reader.lines().enumerate() {
        if let Ok(line) = line_result {
            if let Some(pos) = search_in_line(pattern, &line) {
                results.push(Match::new(line_num + 1, &line, pos));
            }
        }
    }

    results
}

// ===== 5. å­—ç¬¦ä¸²æ‹¼æ¥æ€§èƒ½å¯¹æ¯” =====
fn string_concat_demo() {
    // æ–¹æ³•1ï¼šformat! å®ï¼ˆæ¸…æ™°ï¼Œé€‚åˆå¤æ‚æ ¼å¼ï¼‰
    let formatted = format!("æ–‡ä»¶: {} è¡Œ: {}", "main.rs", 42);
    println!("{}", formatted);

    // æ–¹æ³•2ï¼špush_strï¼ˆé«˜æ•ˆï¼Œé€‚åˆå¾ªç¯ç´¯ç§¯ï¼‰
    let mut accumulated = String::with_capacity(100);  // é¢„åˆ†é…
    for i in 0..5 {
        accumulated.push_str(&format!("item{} ", i));
    }
    println!("{}", accumulated);

    // æ–¹æ³•3ï¼šjoinï¼ˆå¤„ç†é›†åˆï¼‰
    let parts: Vec<&str> = vec!["hello", "world", "rust"];
    let joined = parts.join(", ");
    println!("{}", joined);
}

fn main() {
    println!("=== String ä¸ str å®æˆ˜æ¼”ç¤º ===\n");

    // 1. åˆ›å»ºé…ç½®ï¼ˆ&str â†’ Stringï¼‰
    let config = SearchConfig::new("TODO");
    println!("æœç´¢æ¨¡å¼: {}", config.pattern());

    // 2. æœç´¢å•è¡Œ
    let line = "// TODO: å®ç°æœç´¢åŠŸèƒ½";
    if let Some(pos) = search_in_line(config.pattern(), line) {
        println!("åœ¨ä½ç½® {} æ‰¾åˆ°åŒ¹é…", pos);
    }

    // 3. å­—ç¬¦ä¸²æ‹¼æ¥æ¼”ç¤º
    println!("\n--- å­—ç¬¦ä¸²æ‹¼æ¥ ---");
    string_concat_demo();

    // 4. UTF-8 å®‰å…¨å¤„ç†
    println!("\n--- UTF-8 å¤„ç† ---");
    let text = "Rust å¾ˆæ£’ï¼";
    println!("å­—ç¬¦æ•°: {}", text.chars().count());  // 7
    println!("å­—èŠ‚æ•°: {}", text.len());            // 13

    for (i, c) in text.chars().enumerate() {
        println!("å­—ç¬¦ {}: {}", i, c);
    }
}
```

**è¿è¡Œè¾“å‡ºç¤ºä¾‹ï¼š**
```
=== String ä¸ str å®æˆ˜æ¼”ç¤º ===

æœç´¢æ¨¡å¼: TODO
åœ¨ä½ç½® 3 æ‰¾åˆ°åŒ¹é…

--- å­—ç¬¦ä¸²æ‹¼æ¥ ---
æ–‡ä»¶: main.rs è¡Œ: 42
item0 item1 item2 item3 item4
hello, world, rust

--- UTF-8 å¤„ç† ---
å­—ç¬¦æ•°: 7
å­—èŠ‚æ•°: 13
å­—ç¬¦ 0: R
å­—ç¬¦ 1: u
å­—ç¬¦ 2: s
å­—ç¬¦ 3: t
å­—ç¬¦ 4:
å­—ç¬¦ 5: å¾ˆ
å­—ç¬¦ 6: æ£’
```

---

## ã€é¢è¯•å¿…é—®ã€‘

### é—®é¢˜ï¼š"String å’Œ &str æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿä»€ä¹ˆæ—¶å€™ç”¨å“ªä¸ªï¼Ÿ"

**æ™®é€šå›ç­”ï¼ˆâŒ ä¸å‡ºå½©ï¼‰ï¼š**
"String æ˜¯å¯å˜çš„ï¼Œ&str æ˜¯ä¸å¯å˜çš„ã€‚éœ€è¦ä¿®æ”¹ç”¨ Stringï¼Œä¸éœ€è¦ä¿®æ”¹ç”¨ &strã€‚"

**å‡ºå½©å›ç­”ï¼ˆâœ… æ¨èï¼‰ï¼š**

> **String å’Œ &str çš„åŒºåˆ«å¯ä»¥ä»ä¸‰ä¸ªå±‚é¢ç†è§£ï¼š**
>
> 1. **æ‰€æœ‰æƒå±‚é¢**ï¼šString æ‹¥æœ‰æ•°æ®ï¼Œæ•°æ®å­˜å‚¨åœ¨å †ä¸Šï¼Œç¦»å¼€ä½œç”¨åŸŸä¼šé‡Šæ”¾ï¼›&str æ˜¯å€Ÿç”¨ï¼Œåªæ˜¯ä¸€ä¸ªæŒ‡å‘æ•°æ®çš„è§†å›¾ï¼Œä¸è´Ÿè´£é‡Šæ”¾ã€‚
>
> 2. **å†…å­˜å¸ƒå±€å±‚é¢**ï¼šString æ˜¯ä¸€ä¸ªèƒ–æŒ‡é’ˆï¼ŒåŒ…å« (ptr, len, capacity) å…± 24 å­—èŠ‚ï¼›&str åªæœ‰ (ptr, len) å…± 16 å­—èŠ‚ã€‚è¿™æ„å‘³ç€ä¼ é€’ &str æ¯”ä¼ é€’ String æ›´è½»é‡ã€‚
>
> 3. **ä½¿ç”¨åœºæ™¯å±‚é¢**ï¼š
>    - **å‡½æ•°å‚æ•°**ï¼šä¼˜å…ˆç”¨ `&str`ï¼Œå› ä¸º `&String` å¯ä»¥è‡ªåŠ¨ Deref ä¸º `&str`ï¼Œè¿™æ ·å‡½æ•°æ—¢èƒ½æ¥å— String ä¹Ÿèƒ½æ¥å— &str
>    - **ç»“æ„ä½“å­—æ®µ**ï¼šå¦‚æœéœ€è¦æ‹¥æœ‰æ•°æ®ï¼Œç”¨ `String`ï¼›å¦‚æœåªæ˜¯ä¸´æ—¶å¼•ç”¨ï¼Œå¯ä»¥ç”¨ `&'a str` åŠ ç”Ÿå‘½å‘¨æœŸ
>    - **è¿”å›å€¼**ï¼šå¦‚æœè¿”å›æ–°åˆ›å»ºçš„å­—ç¬¦ä¸²ï¼Œç”¨ `String`ï¼›å¦‚æœè¿”å›è¾“å…¥çš„ä¸€éƒ¨åˆ†ï¼Œç”¨ `&str`
>
> **åœ¨å®é™…é¡¹ç›®å¦‚ ripgrep ä¸­**ï¼šæœç´¢å‡½æ•°çš„ pattern å‚æ•°ç”¨ `&str`ï¼Œé…ç½®ç»“æ„ä½“ä¸­å­˜å‚¨æ¨¡å¼ç”¨ `String`ï¼ŒåŒ¹é…ç»“æœä¸­çš„è¡Œå†…å®¹ç”¨ `String`ï¼ˆå› ä¸ºéœ€è¦å­˜å‚¨ï¼‰ï¼Œä½†è·å–åŒ¹é…æ–‡æœ¬æ—¶è¿”å› `&str`ï¼ˆé›¶æˆæœ¬åˆ‡ç‰‡ï¼‰ã€‚

**ä¸ºä»€ä¹ˆè¿™ä¸ªå›ç­”å‡ºå½©ï¼Ÿ**
1. âœ… åˆ†å±‚æ¬¡è§£é‡Šï¼Œå±•ç¤ºç³»ç»Ÿæ€§æ€è€ƒ
2. âœ… æåˆ°äº†å†…å­˜å¸ƒå±€ï¼Œå±•ç¤ºåº•å±‚ç†è§£
3. âœ… ç»™å‡ºäº†å…·ä½“çš„ä½¿ç”¨åœºæ™¯å’Œæœ€ä½³å®è·µ
4. âœ… ç»“åˆäº†å®é™…é¡¹ç›®ï¼ˆripgrepï¼‰ï¼Œå±•ç¤ºå®æˆ˜ç»éªŒ

---

## ã€åŒ–éª¨ç»µæŒã€‘

### å¡ç‰‡1ï¼šç›´è§‰ç†è§£ ğŸ¯

**ä¸€å¥è¯ï¼š** String æ˜¯"è‡ªå·±çš„"ï¼Œ&str æ˜¯"å€Ÿæ¥çœ‹çš„"

**ä¸¾ä¾‹ï¼š**
```rust
let owned = String::from("mine");    // æˆ‘çš„
let borrowed: &str = "look at this"; // å€Ÿæ¥çœ‹çš„
```

**åº”ç”¨ï¼š** ripgrep ä¸­é…ç½®å­—æ®µç”¨ Stringï¼ˆéœ€è¦æ‹¥æœ‰ï¼‰ï¼Œå‡½æ•°å‚æ•°ç”¨ &strï¼ˆåªéœ€è¯»å–ï¼‰

---

### å¡ç‰‡2ï¼šå†…å­˜å¸ƒå±€ ğŸ“

**ä¸€å¥è¯ï¼š** String = (ptr, len, capacity)ï¼Œ&str = (ptr, len)

**ä¸¾ä¾‹ï¼š**
```rust
// String: 24 å­—èŠ‚ï¼ˆæ ˆï¼‰+ N å­—èŠ‚ï¼ˆå †ï¼‰
// &str: 16 å­—èŠ‚ï¼ˆæ ˆï¼‰+ 0 å­—èŠ‚ï¼ˆä¸æ‹¥æœ‰å †æ•°æ®ï¼‰
```

**åº”ç”¨ï¼š** ä¼ é€’ &str æ¯” String æ›´è½»é‡ï¼Œripgrep çš„çƒ­è·¯å¾„å¤§é‡ä½¿ç”¨ &str

---

### å¡ç‰‡3ï¼šæ‰€æœ‰æƒè§„åˆ™ ğŸ”‘

**ä¸€å¥è¯ï¼š** String è´Ÿè´£é‡Šæ”¾å†…å­˜ï¼Œ&str ä¸è´Ÿè´£

**ä¸¾ä¾‹ï¼š**
```rust
{
    let s = String::from("temp");
}  // s é‡Šæ”¾ï¼Œå†…å­˜è¢«å›æ”¶

fn read(s: &str) {}  // ä¸é‡Šæ”¾ï¼Œåªæ˜¯å€Ÿç”¨
```

**åº”ç”¨ï¼š** ç†è§£ä¸ºä»€ä¹ˆ ripgrep çš„ Searcher æŒæœ‰ &str è€Œä¸æ˜¯ String

---

### å¡ç‰‡4ï¼šç±»å‹è½¬æ¢ ğŸ”„

**ä¸€å¥è¯ï¼š** &String â†’ &str é›¶æˆæœ¬ï¼Œ&str â†’ String éœ€è¦åˆ†é…

**ä¸¾ä¾‹ï¼š**
```rust
let owned = String::from("hello");
let borrowed: &str = &owned;      // é›¶æˆæœ¬ Deref
let cloned: String = borrowed.to_string(); // å †åˆ†é…
```

**åº”ç”¨ï¼š** å‡½æ•°å‚æ•°ç”¨ &strï¼Œéœ€è¦å­˜å‚¨æ—¶å† to_string()

---

### å¡ç‰‡5ï¼šå‡½æ•°ç­¾åæœ€ä½³å®è·µ âœ…

**ä¸€å¥è¯ï¼š** å‚æ•°ç”¨ &strï¼Œè¿”å›å€¼çœ‹æƒ…å†µ

**ä¸¾ä¾‹ï¼š**
```rust
// âœ… å‚æ•°ç”¨ &str
fn search(pattern: &str, text: &str) -> bool { ... }

// âœ… è¿”å›æ–°å­—ç¬¦ä¸²ç”¨ String
fn create_message(name: &str) -> String { ... }

// âœ… è¿”å›åˆ‡ç‰‡ç”¨ &str
fn first_word(s: &str) -> &str { ... }
```

**åº”ç”¨ï¼š** ripgrep çš„ Regex::new() æ¥å— &str

---

### å¡ç‰‡6ï¼šå­—ç¬¦ä¸²å­—é¢é‡ ğŸ“

**ä¸€å¥è¯ï¼š** "hello" æ˜¯ &'static strï¼Œæ°¸è¿œæœ‰æ•ˆ

**ä¸¾ä¾‹ï¼š**
```rust
fn get_error() -> &'static str {
    "Something went wrong"  // å¯ä»¥è¿”å›ï¼
}
```

**åº”ç”¨ï¼š** ripgrep çš„é”™è¯¯æ¶ˆæ¯ã€å¸®åŠ©æ–‡æœ¬éƒ½æ˜¯ &'static str

---

### å¡ç‰‡7ï¼šUTF-8 é™·é˜± âš ï¸

**ä¸€å¥è¯ï¼š** ç´¢å¼•æ˜¯å­—èŠ‚ä½ç½®ï¼Œä¸æ˜¯å­—ç¬¦ä½ç½®

**ä¸¾ä¾‹ï¼š**
```rust
let s = "ä½ å¥½";
// let c = s[0];        // âŒ ç¼–è¯‘é”™è¯¯
let c = &s[0..3];       // âœ… "ä½ "ï¼ˆ3å­—èŠ‚ï¼‰
let c = s.chars().next(); // âœ… Some('ä½ ')
```

**åº”ç”¨ï¼š** ripgrep å¤„ç† UTF-8 æ–‡ä»¶æ—¶å¿…é¡»è€ƒè™‘å­—ç¬¦è¾¹ç•Œ

---

### å¡ç‰‡8ï¼šCow è¿›é˜¶ ğŸ„

**ä¸€å¥è¯ï¼š** Cow<str> æ˜¯ "å†™æ—¶å¤åˆ¶"ï¼Œçµæ´»è¿”å›å€Ÿç”¨æˆ–æ‹¥æœ‰

**ä¸¾ä¾‹ï¼š**
```rust
use std::borrow::Cow;

fn process(s: &str) -> Cow<'_, str> {
    if s.contains("bad") {
        Cow::Owned(s.replace("bad", "good"))
    } else {
        Cow::Borrowed(s)  // ä¸å¤åˆ¶
    }
}
```

**åº”ç”¨ï¼š** ripgrep ä¸­æŸäº›åœºæ™¯ä½¿ç”¨ Cow é¿å…ä¸å¿…è¦çš„åˆ†é…

---

### å¡ç‰‡9ï¼šripgrep ä¸­çš„åº”ç”¨ ğŸ”

**ä¸€å¥è¯ï¼š** æœç´¢å‚æ•°ç”¨ &strï¼Œå­˜å‚¨ç»“æœç”¨ String

**ä¸¾ä¾‹ï¼š**
```rust
// ripgrep é£æ ¼
fn grep_line(pattern: &str, line: &str) -> Option<Match> {
    // pattern å’Œ line éƒ½æ˜¯å€Ÿç”¨
    // Match å†…éƒ¨å­˜å‚¨ Stringï¼ˆéœ€è¦æ‹¥æœ‰è¡Œå†…å®¹ï¼‰
}
```

**åº”ç”¨ï¼š** ç†è§£ grep-searcher çš„ Searcher trait è®¾è®¡

---

### å¡ç‰‡10ï¼šé€ŸæŸ¥è¡¨ ğŸ“‹

**String vs &str é€ŸæŸ¥ï¼š**

| åœºæ™¯ | ç”¨ä»€ä¹ˆ |
|-----|-------|
| å‡½æ•°å‚æ•° | &str |
| ç»“æ„ä½“å­—æ®µï¼ˆéœ€è¦æ‹¥æœ‰ï¼‰ | String |
| ç»“æ„ä½“å­—æ®µï¼ˆä¸´æ—¶å¼•ç”¨ï¼‰ | &'a str |
| è¿”å›æ–°å­—ç¬¦ä¸² | String |
| è¿”å›è¾“å…¥çš„åˆ‡ç‰‡ | &str |
| å­—ç¬¦ä¸²æ‹¼æ¥ | format! æˆ– String::push_str |
| å­˜å‚¨å­—ç¬¦ä¸²å­—é¢é‡ | &'static str |

**åº”ç”¨ï¼š** å†™ ripgrep é£æ ¼ä»£ç çš„å‚è€ƒ

---

## ã€ä¸€å¥è¯æ€»ç»“ã€‘

**String æ˜¯æ‹¥æœ‰æ‰€æœ‰æƒçš„å †åˆ†é…å¯å˜å­—ç¬¦ä¸²ï¼Œ&str æ˜¯é›¶æˆæœ¬çš„å€Ÿç”¨è§†å›¾ï¼›ripgrep æºç ä¸­å‡½æ•°å‚æ•°æ™®éä½¿ç”¨ &str ä»¥è·å¾—æœ€å¤§çµæ´»æ€§ï¼Œç»“æ„ä½“å­—æ®µéœ€è¦å­˜å‚¨æ—¶ä½¿ç”¨ Stringã€‚**

---

## ğŸ“ å­¦ä¹ æ£€æŸ¥æ¸…å•

- [ ] ç†è§£ String å’Œ &str çš„æ‰€æœ‰æƒåŒºåˆ«
- [ ] çŸ¥é“ä¸¤è€…çš„å†…å­˜å¸ƒå±€
- [ ] æŒæ¡ç±»å‹è½¬æ¢æ–¹æ³•å’Œæˆæœ¬
- [ ] ç†è§£ä¸ºä»€ä¹ˆå‡½æ•°å‚æ•°ä¼˜å…ˆç”¨ &str
- [ ] çŸ¥é“å­—ç¬¦ä¸²å­—é¢é‡çš„ç±»å‹æ˜¯ &'static str
- [ ] ç†è§£ UTF-8 ç´¢å¼•çš„é™·é˜±
- [ ] èƒ½å†™å‡º ripgrep é£æ ¼çš„å­—ç¬¦ä¸²å¤„ç†ä»£ç 

## ğŸ”— ä¸‹ä¸€æ­¥å­¦ä¹ 

- **03_è¿­ä»£å™¨ä¸é—­åŒ…**ï¼šå­—ç¬¦ä¸²çš„ chars()ã€bytes() ç­‰æ–¹æ³•è¿”å›è¿­ä»£å™¨
- **04_é”™è¯¯å¤„ç†**ï¼šå­—ç¬¦ä¸²è§£æç»å¸¸æ¶‰åŠ Result å¤„ç†
